name: Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # -------------------------
      # Checkout code
      # -------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # -------------------------
      # Install detect-secrets
      # -------------------------
      - name: Install detect-secrets
        run: |
          python3 -m pip install --upgrade pip
          pip install detect-secrets

      # -------------------------
      # ðŸ” SECRET SCAN (FAIL CI/CD IF FOUND)
      # -------------------------
      - name: Run secret scan
        run: |
          detect-secrets scan . > scan-result.json

          python3 - << 'EOF'
          import json, sys

          with open("scan-result.json") as f:
              data = json.load(f)

          if data.get("results"):
              print("âŒ Secrets found in repository!")
              sys.exit(1)
          else:
              print("âœ… No secrets found.")
          EOF

      # -------------------------
      # Your normal build step
      # -------------------------
      - name: Continue build
        run: |
          echo "âœ… No secrets found. Build continues..."
